<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>&#20320;&#30340;&#31532;&#19968;&#20010;CODESYS&#31243;&#24207; </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="&#20320;&#30340;&#31532;&#19968;&#20010;CODESYS&#31243;&#24207; ">
    <meta name="generator" content="docfx 2.30.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="你的第一个codesys程序">你的第一个CODESYS程序</h1>

<ul>
<li>开始之前</li>
<li>关于你的第一个项目的内容</li>
<li>制备</li>
<li>创建项目并选择PLC设备</li>
<li>在项目中编写控制应用程序：要执行此操作，请参阅以下部分：</li>
<li>声明全局变量</li>
<li>在CFC编辑器中创建冷却控制的主程序</li>
<li>在梯形图编辑器中创建信号管理的程序块</li>
<li>在主程序中调用信号程序</li>
<li>创建一个用于模拟的ST程序块</li>
<li>任务配置中将要执行的程序的规范</li>
<li>定义与PLC通讯的“活动应用程序”</li>
<li>调试应用程序</li>
<li>建立与PLC的连接：为此，请参阅以下部分：</li>
<li>启动网关服务器和PLC</li>
<li>在第一次通信配置期间：添加网关</li>
<li>设置通讯通道</li>
<li>在PLC上的应用：请参考以下章节</li>
<li>将应用程序加载到PLC</li>
<li>启动应用程序</li>
<li>在运行时监视和一次性写入变量值</li>
<li>设置断点并在运行时单步执行</li>
<li>在运行时执行单个循环</li>
</ul>
<h2 id="开始之前">开始之前</h2>
<p><strong>数据安全：</strong>为了尽量减少数据安全漏洞的风险，我们建议采取以下组织和技术措施：</p>
<ul>
<li>避免从开放网络和互联网访问PLC和控制网络。</li>
<li>使用VPN进行远程访问。</li>
<li>安装防火墙。</li>
<li>如果要在网络上发布可视化文件，请设置密码以防止未经授权的访问。</li>
<li>使用最新版本的网关服务器和Web服务器。</li>
</ul>
<p><strong>安装CODESYS：</strong></p>
<p><strong>注意</strong><br>
安装包括开发系统，CODESYS网关和CODESYS Control Win V3，其服务可通过Windows任务栏访问。 这三个程序是模拟计算机上的控制器所必需的。</p>
<h2 id="关于你的第一个项目的内容">关于你的第一个项目的内容</h2>
<p>在本教程中，您将编写一个简单的冰箱控制器。
已完成的项目<code>RefrigeratorControl.project_archive</code>可以在“<code>Projects</code>”目录下的CODESYS安装目录中找到。
除了您将逐步创建的示例项目之外，已完成的项目还包含完整的可视化操作和诊断。</p>
<ul>
<li>与传统的冰箱一样，温度由用户通过旋转控制器来指定。</li>
<li>冰箱通过传感器确定实际温度。 如果太高，冰箱会通过可调节的延时启动压缩机。</li>
<li>压缩机冷却直至达到所需的温度，减去1度的滞后。 滞后是为了防止实际温度在温度设定点附近波动太大，这将导致压缩机不断地自行关闭和打开。</li>
<li>如果门打开，冰箱内部的灯会亮起。 如果门打开时间过长，则输出间歇性的声音信号。</li>
<li>如果压缩机在电机长时间工作的情况下仍未达到温度设定值，蜂鸣器将发出一个恒定的声音信号。</li>
</ul>
<p>项目计划：
冷却活动在应用程序的主程序中进行控制，信号管理在另一个程序块中进行。 <code>Standard</code>库中提供了所需的标准功能块。
由于在此示例项目中没有连接真正的温度传感器和实际的执行器，您还需要编写一个程序来模拟温度的上升和下降。
这将允许您在在线模式下监控冰箱控制器的操作。</p>
<p>必须在全局变量列表中定义要由所有功能块使用的变量。</p>
<h2 id="准备">准备</h2>
<p>您已经安装了CODESYS开发系统并使用默认配置文件“CODESYS V&lt;当前版本&gt;”启动它。
开发系统的框架窗口用标准菜单栏打开; 目前还没有打开的项目。</p>
<h2 id="创建项目并选择plc设备">创建项目并选择PLC设备</h2>
<ol>
<li>选择命令<em>File ‣ New Project</em>。</li>
<li>在<em>Templates</em>窗口中，选择<em>Standard Project</em>模板。</li>
<li>输入项目的名称和存储位置，然后单击<em>OK</em>按钮。<br>
⇒打开<em>Standard Project</em>对话框，输入设备类型和主程序的实现语言。</li>
<li>在<em>Device</em>列表中，选择条目<em>CODESYS Control Win V3</em>。</li>
<li>在<em>PLC_PRG</em>列表中选择条目<em>Continuous Function Chart (CFC)</em>
,然后单击<em>OK</em>按钮。<br>
⇒项目在CODESYS框架窗口中打开。</li>
</ol>
<p>在框架窗口的左侧的<em>Devices</em>视图中，您将看到“设备树”。之前选择的PLC设备以默认名称<em>Device</em>显示。<br>
由您来编程的PLC应用程序的<em>Application</em>对象已经挂载在<em>PLC Logic</em>对象下。<br>
<em>Application</em>已经包含<em>PLC_PRG</em>主程序和<em>Library manager</em>对象。<br>
<em>Library manager</em>已经包含了<em>IoStandard</em>和<em>Standard</em>库。 <em>IoStandard</em>是I/O配置所必需的。 <em>Standard</em>库包含IEC 61131-3标准描述的所有功能和功能块。<br>
<em>Task Configuration</em>对象挂载在设备数底部，包含<em>Main task</em>，<em>Main task</em>控制<em>PLC_PRG</em>的处理。 例如，用于可视化的对象可以稍后插入到<em>Task Configuration</em>下方。<br>
除了<em>IoStandard</em>和<em>Standard</em>库之外，此示例项目还需要<em>Util</em>库：</p>
<ol>
<li>双击设备树中的<em>Library manager</em>对象。<br>
⇒打开<em>Library manager</em>编辑器。</li>
<li>在编辑器的标题栏中，单击<em>Add library</em>，然后在<em>Add library</em>对话框中选择<em>Util</em>库。<br>
单击<em>OK</em>按钮确认选择<br>
⇒<em>Util</em>库被添加到<em>Library manager</em>中，库中的功能块可供您在项目中使用。</li>
</ol>
<h2 id="在项目中编写控制应用程序要执行此操作请参阅以下部分">在项目中编写控制应用程序：要执行此操作，请参阅以下部分：</h2>
<h2 id="声明全局变量">声明全局变量</h2>
<p>首先，声明你希望在整个应用程序中使用的变量。 为此，请在<em>Application</em>下创建一个全局变量列表：</p>
<ol>
<li>选定<em>Application</em>并在上下文菜单中选择命令<em>Add Object ‣ Global Variables List</em>。将自动输入的名称<em>GVL</em>更改为<em>Glob_Var</em>并单击<em>Add</em>确认。<br>
⇒对象<img src="https://help.codesys.com/api-content/2/codesys/3.5.12.0/en/_images/_cds_icon_gvl.png" alt=""><em>Glob_Var</em>出现在<img src="https://help.codesys.com/api-content/2/codesys/3.5.12.0/en/_images/_cds_icon_application.png" alt=""><em>Application</em>下。 <em>GVL</em>编辑器在设备树的右侧打开。</li>
<li>出现文本视图时，它已经包含关键字<code>VAR_GLOBAL</code>和<code>END_VAR</code>。在我们的例子中，通过点击编辑器右侧边的<img src="https://help.codesys.com/api-content/2/codesys/3.5.12.0/en/_images/_cds_img_button_decl_editor_tabular.png" alt="">按钮激活表格视图。<br>
⇒出现一个空行。光标在<em>Name</em>列中。</li>
<li>在上下文菜单中选择命令<em>Insert</em>。<br>
⇒打开输入栏。同时<em>Scope</em> <code>VAR_GLOBAL</code>和<em>Data type</em> <code>BOOL</code>自动填入该行。</li>
<li>在字段<em>Name</em>中键入<code>rTempActual</code>。</li>
<li>双击<em>Data type</em>列中的字段。<br>
⇒该字段现在是可编辑的，并出现按钮<img src="https://help.codesys.com/api-content/2/codesys/3.5.12.0/en/_images/cds_icon_open_input_asisstant.png" alt="">。</li>
<li>单击按钮<img src="https://help.codesys.com/api-content/2/codesys/3.5.12.0/en/_images/cds_icon_open_input_asisstant.png" alt="">，然后选择<em>Input assistant</em>。<br>
⇒打开<em>Input assistant</em>对话框。</li>
<li>选择数据类型<em>REAL</em>，然后单击<em>OK</em>按钮。</li>
<li>在<em>Initialization</em>列中输入一个数值，例如8.0。</li>
</ol>
<p>以相同的方式声明以下变量。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>数据类型</th>
<th>初始值</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>rTempActual</code></td>
<td><code>REAL</code></td>
<td>数字，例如<code>8.0</code></td>
</tr>
<tr>
<td><code>rTempSet</code></td>
<td><code>REAL</code></td>
<td>数字，例如<code>8.0</code></td>
</tr>
<tr>
<td><code>rDoorOpen</code></td>
<td><code>BOOL</code></td>
<td><code>FALSE</code></td>
</tr>
<tr>
<td><code>timAlarmThreshold</code></td>
<td><code>TIME</code></td>
<td><code>T#30S</code>压缩机运行该时间后，信号响起</td>
</tr>
<tr>
<td><code>rDoorOpenThreshold</code></td>
<td><code>TIME</code></td>
<td><code>T#10S</code>开门后的时间，然后发出一个信号</td>
</tr>
<tr>
<td><code>bCompressor</code></td>
<td><code>BOOL</code></td>
<td><code>FALSE</code></td>
</tr>
<tr>
<td><code>bSignal</code></td>
<td><code>BOOL</code></td>
<td><code>FALSE</code></td>
</tr>
<tr>
<td><code>bLamp</code></td>
<td><code>BOOL</code></td>
<td><code>FALSE</code></td>
</tr>
</tbody>
</table>
<h2 id="在cfc编辑器中创建冷却控制的主程序">在CFC编辑器中创建冷却控制的主程序</h2>
<p>您现在将在默认创建的主程序块<em>PLC_PRG</em>中描述应用程序的主要功能：如果实际温度高于温度设定值加上滞后，压缩机将被激活并开始冷却。 如果实际温度低于设定值减去滞后，则关闭压缩机。<br>
为了在实现语言CFC中描述此功能，请执行以下步骤：</p>
<ol>
<li>在设备树中双击<em>PLC_PRG</em>。<br>
⇒CFC编辑器将打开<em>PLC_PRG</em>选项卡。声明编辑器以文本或表格形式出现在图形编辑器的上方。右边是<em>Tools</em>窗口。</li>
<li>在<em>Tools</em>窗口中单击<em>Input</em>，然后用鼠标将其拖动到CFC编辑器中插入它。</li>
<li>单击CFC编辑器中的元素，然后单击<img src="https://help.codesys.com/api-content/2/codesys/3.5.12.0/en/_images/_cds_icon_input_assistent.png" alt="">打开输入助手。从<em>Variables</em>类别中，选择<em>Application ‣ Glob_Var</em>下的变量<code>rTempActual</code>。用这种方法你可以在这里引用全局变量<code>rTempActual</code>。</li>
<li>与3.一样，使用全局变量<code>rTempSet</code>创建另一个输入。</li>
<li>再创建一个输入，然后点击三个问号<em>???</em>并将其替换为名称<em>rHysteresis</em>。<br>
⇒因为这不是已知变量的名称，所以出现<em>Auto Declare</em>对话框。该名称已被填入到对话框中。</li>
<li>使用<em>Data type</em><code>REAL</code>和<em>Initialization</em>值<code>1</code>填充Declare变量对话框中的字段。单击OK按钮。<br>
⇒变量<code>rHysteresis</code>出现在声明编辑器中。</li>
<li>现在再插入一个功能块：单击工具窗口中的<em>Box</em>元素，并用鼠标将其拖动到CFC编辑器中。<br>
⇒功能块出现在CFC编辑器中。</li>
<li>使用<code>ADD</code>替换<em>???</em>。<br>
⇒<em>(&nbsp;)ADD</em>功能块由标准库提供。它将连接到它的所有输入进行相加。</li>
<li>将<code>Glob_Var.rTempSet</code>输入连接到<em>ADD</em>功能块。为此，请单击输入的输出连接器，并将其拖动到<em>ADD</em>功能块的上部输入。</li>
<li>同样，将输入<code>rHysteresis</code>连接到ADD功能块的下部输入。<br>
⇒两个输入rHysteresis和rTempSet现在由ADD添加。</li>
<li>如果您希望在编辑器中移动元素，请单击元素中或框架上的空白区域，以便选择该元素（红色边框，红色阴影）。按住鼠标并将元素拖动到所需的位置。</li>
<li>在ADD功能块的右侧创建另一个功能块。它的功能是比较<em>Glob_Var.rTempActual</em>和<em>Glob_Var.rTempSet + rHysteresis</em>之和。赋予功能块<code>GT</code>（大于）的功能。<br>
⇒<code>GT</code>功能块也来自<code>Standard</code>库，工作原理如下：<code>IF (upper input &gt; lower input) THEN output</code></li>
<li>将输入<em>Glob_Var_rTempActual</em>连接到<em>GT</em>功能块的上部输入端。</li>
<li>将<em>ADD</em>功能块的输出连接到<em>GT</em>功能块的下部输入。</li>
<li>现在根据输入条件（Set - Reset）在<em>GT</em>功能块的右侧创建一个功能块，以启动或停止冷却压缩机。在字段<em>???</em>中输入名称<code>SR</code>。使用Enter键关闭功能块（<code>SR_0</code>）上方打开的输入字段。<br>
⇒打开<em>Declare variables</em>对话框。</li>
<li>声明名称为<code>SR_0</code>和数据类型为<code>SR</code>的变量。单击<em>OK</em>按钮。<br>
⇒<code>Standard</code>库中定义的<em>SR</em>功能块用于在<em>GT</em>功能块的输出端定义<code>THEN</code>。出现输入<code>SET1</code>和<code>RESET</code>。</li>
<li>将<em>GT</em>功能块右侧的输出连接器连接到<em>SR_0</em>功能块的<em>SET1</em>输入。<br>
⇒<code>SR</code>可以将一个布尔变量从<code>FALSE</code>设置为<code>TRUE</code>，然后再返回。如果输入<em>SET1</em>的条件满足，则布尔变量设置为<code>TRUE</code>。如果满足<code>RESET</code>条件，变量将重新复位。我们例子中的布尔（全局）变量是<code>bCompressor</code>。</li>
<li>创建一个元素<em>Output</em>并将其分配给全局变量<code>Glob_Var.Compressor</code>。在<em>Glob_Var.Compressor</em>和<em>SR</em>的输出连接器<code>Q1</code>之间画一条连线。
现在指定压缩机应该再次关闭的状态，即SR功能块的RESET输入接收到一个TRUE信号。 要做到这一点，你要制定与上述相反的条件。 使用功能块SUB（减）和LT（小于）来做到这一点。</li>
</ol>
<p>最后创建下面的CFC图表：
<img src="https://help.codesys.com/api-content/2/codesys/3.5.12.0/en/_images/_cds_img_tutorial_refrigerator_plcprg_cfc_diagram.png" alt=""></p>
<h2 id="在梯形图编辑器中创建信号管理的程序块">在梯形图编辑器中创建信号管理的程序块</h2>
<p>在另一个程序块中，您现在将执行警报蜂鸣器的信号管理与打开和关闭灯泡。适合用梯形图（LD）语言实现。</p>
<p>在单独网络中处理以下信号：</p>
<ul>
<li>如果压缩机由于温度过高而运行时间过长，则通过连续的声音信号引起注意。</li>
<li>如果门打开时间过长，则通过间歇信号引起注意。</li>
<li>只要门打开，灯就亮。</li>
</ul>
<ol>
<li>在设备树的<em>Application</em>下方，使用<em>Ladder Diagram (LD)</em>实现语言创建一个类型为<em>Program</em>的POU对象。名称为<em>Signals</em>。
⇒<em>Signals</em>对象出现在<em>PLC_PRG</em>下面的设备树中。在梯形图编辑器打开<em>Signals</em>选项卡。声明编辑器出现在上部，<em>Tools</em>窗口出现在右侧。LD包含一个空网络。</li>
<li><p>在网络中创建一个程序，当压缩机运行时间过长而没有达到温度设定值时，会发出声音信号。为此，插入一个定时器功能块<em>TON</em>。它在指定的时间之后才将布尔TRUE信号切换为<code>TRUE</code>：在<em>Tools</em>窗口中的<em>Function blocks</em>下选择一个<em>TON</em>，并用鼠标将其拖入空网络，然后拖到出现的矩形<em>Start here</em>处。当字段变为绿色时释放鼠标按钮。  <br><br>⇒功能块显示为带有输入和输出的矩形，并自动给出实例名称<code>TON_0</code>。上面的输入默认已经显示为功能块上游的触点。</p>
<p><strong>注意</strong><br>
如果要阅读功能块的在线帮助，请将光标放在功能块的“TON”字符串中，然后按<code>F1</code>键。</p>
</li>
<li><p>编程时，只要冷却压缩机开始运行，功能块就会被激活：为此，请在功能块<code>Glob_Var.Compressor</code>的上部输入处命名触点。您已经在<em>GVL Glob_Var</em>中定义了这个布尔变量。</p>
<p><strong>注意</strong>
当您开始在输入位置输入一个变量名时，您将自动获得名称以输入字符开头的所有变量的列表，并且可以在此处使用。这种帮助是CODESYS选项中用于智能编程的标准设置。</p>
</li>
<li><p>插入要激活的信号。为此，从工具类别<em>Ladder elements</em>拖动一个<em>Coil</em>到<code>TON</code>功能块的输出端<code>Q</code>. 将线圈命名为<code>Glob_Var.bSignal</code>。</p>
</li>
<li><p>定义从<code>TON</code>功能块激活直到信号发出的时间段：该定义通过变量<code>Glob_Var.timAlarmThreshold</code>进行，该变量为<code>TON_0</code>的输入<code>PT</code>。为此，请单击输入连接右侧的细边矩形，然后输入变量名称。</p>
</li>
<li><p>点击TON功能块并在上下文菜单中选择<em>Remove unused FB call parameters</em>命令。<br>
⇒未使用的输出ET被删除。</p>
</li>
<li><p>在LD的第二个网络中，编程使得如果门打开时间过长，会间歇发出信号。<br>
在“编辑器”窗口中单击第一个网络下面的地方，然后在上下文菜单中选择<em>Insert network</em>命令。<br>
⇒显示编号为2的空白网络。</p>
</li>
<li><p>与在第一个网络中一样，实现一个<em>TON</em>功能块，用于时间控制激活信号，这次由输入IN的全局变量<code>Glob_Var.rDoorOpen</code>触发。在输入<code>PT</code>，添加全局变量<code>GlobVar.timDoorOpenThreshold</code>。</p>
</li>
<li><p>另外，在该网络的TON功能块的输出端<code>Q</code>上，从<em>Util</em>库中添加一个<em>BLINK</em>功能块，并命名为<code>Blink_0</code>。</p>
</li>
<li><p><em>BLINK</em>对转发<code>Q</code>的信号进行计时，并因此对<em>GlobVar.bSignal</em>进行计时。</p>
</li>
</ol>
<h2 id="在主程序中调用信号程序">在主程序中调用信号程序</h2>
<h2 id="创建一个用于模拟的st程序块">创建一个用于模拟的ST程序块</h2>
<h2 id="任务配置中将要执行的程序的规范">任务配置中将要执行的程序的规范</h2>
<h2 id="定义与plc通讯的活动应用程序">定义与PLC通讯的“活动应用程序”</h2>
<h2 id="调试应用程序">调试应用程序</h2>
<h2 id="建立与plc的连接为此请参阅以下部分">建立与PLC的连接：为此，请参阅以下部分：</h2>
<h2 id="启动网关服务器和plc">启动网关服务器和PLC</h2>
<h2 id="在第一次通信配置期间添加网关">在第一次通信配置期间：添加网关</h2>
<h2 id="设置通讯通道">设置通讯通道</h2>
<h2 id="在plc上的应用请参考以下章节">在PLC上的应用：请参考以下章节</h2>
<h2 id="将应用程序加载到plc">将应用程序加载到PLC</h2>
<h2 id="启动应用程序">启动应用程序</h2>
<h2 id="在运行时监视和一次性写入变量值">在运行时监视和一次性写入变量值</h2>
<h2 id="设置断点并在运行时单步执行">设置断点并在运行时单步执行</h2>
<h2 id="在运行时执行单个循环">在运行时执行单个循环</h2>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2017 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
